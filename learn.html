<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Learn | Goldwire Games</title>
  <meta name="description" content="Explore the species and habitats of Trophic.">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Cabin:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    :root{
      --bg-color: #f7f3e9;
      --text-color: #2a2a2a;
      --accent-green: #4d7b48;
      --accent-orange: #d08a43;
      --accent-gold: #b8913b;
      --card-bg: #ffffff;
      --nav-bg: rgba(241,236,223,0.85);
      --bg-night: #0d0f11;
      --text-night: #e8e8e8;
      --card-night: #141619;
    }

    *{box-sizing:border-box; transition: all 0.22s ease;}
    body{
      margin:0;
      font-family: 'Cabin', sans-serif;
      background: var(--bg-color) url('paper-texture.png');
      background-size: 350px;
      color:var(--text-color);
    }
    body.night{ background: var(--bg-night); color:var(--text-night); }

    /* Stars (Shared) */
    #stars{ pointer-events:none; position:fixed; inset:0; z-index:0; opacity:0; transition:opacity 0.9s; }
    body.night #stars{ opacity:1; }
    #stars::after{
      content:""; position:absolute; inset:0;
      background-image: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.9) 0.5px, transparent 2px);
      background-size: 100px 100px; opacity:0.8;
    }

    /* NAV */
    nav{
      position: sticky; top:0; z-index: 40;
      display:flex; justify-content:center; gap:30px;
      padding:14px 18px;
      background: var(--nav-bg); backdrop-filter: blur(4px);
      border-bottom: 1px solid rgba(77,123,72,0.18);
      border-radius: 0 0 12px 12px;
    }
    nav a, .dropbtn { color: var(--accent-gold); text-decoration:none; font-weight:700; cursor: pointer; font-size: 1rem; font-family: 'Cabin', sans-serif; }
    nav a:hover, .dropbtn:hover { color: var(--accent-orange); }
    #moon-toggle{ position:absolute; right:16px; top:10px; font-size:1.5rem; cursor:pointer; }

    /* Dropdown CSS */
    .dropdown { position: relative; display: inline-block; }
    .dropdown-content {
      display: none; position: absolute; top: 100%; left: 50%; transform: translateX(-50%);
      background-color: var(--card-bg); min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); border-radius: 8px; z-index: 50;
      border: 1px solid rgba(77,123,72,0.2); overflow: hidden;
    }
    body.night .dropdown-content { background-color: var(--card-night); border-color: #444; }
    .dropdown-content a { color: var(--text-color); padding: 12px 16px; text-decoration: none; display: block; text-align: center; }
    body.night .dropdown-content a { color: var(--text-night); }
    .dropdown-content a:hover { background-color: rgba(77,123,72,0.1); color: var(--accent-green); }
    .dropdown:hover .dropdown-content { display: block; }

    .container{ max-width:1200px; margin:0 auto; padding:40px 20px; position:relative; z-index:10; }

    h1, h2{ font-family:'Merriweather', serif; text-align:center; color:var(--accent-green); }

    /* FILTERS */
    .filter-bar {
      display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-bottom: 40px;
    }
    .filter-btn {
      padding: 10px 20px; border: 2px solid var(--accent-green); background: transparent;
      border-radius: 20px; cursor: pointer; font-weight: 700; color: var(--accent-green);
      font-family: 'Cabin', sans-serif;
    }
    .filter-btn:hover, .filter-btn.active {
      background: var(--accent-green); color: #fff;
    }

    /* SPECIES GRID */
    .species-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 25px;
    }

    /* SPECIES CARD */
    .species-card {
      background: var(--card-bg); border-radius: 12px; overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
      border: 1px solid rgba(0,0,0,0.05);
      display: flex; flex-direction: column;
      position: relative;
      animation: fadeIn 0.5s ease;
    }
    body.night .species-card { background: var(--card-night); border-color: #333; }

    .species-img {
      height: 160px; background-color: #ccc; background-size: cover; background-position: center; position: relative;
    }
    .species-type {
      position: absolute; top: 10px; left: 10px;
      background: rgba(0,0,0,0.6); color: #fff; padding: 4px 8px; border-radius: 4px;
      font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;
    }

    .card-body { padding: 16px; flex-grow: 1; display: flex; flex-direction: column; }
    .scientific-name { font-style: italic; color: #888; font-size: 0.85rem; margin-bottom: 4px; }
    .common-name { font-family: 'Merriweather', serif; font-size: 1.25rem; font-weight: 700; margin: 0 0 8px; color: var(--text-color); }
    body.night .common-name { color: var(--text-night); }

    /* Range Map Visualization (CSS Placeholder) */
    .range-map {
      height: 50px; width: 100%; background: #eee; margin: 8px 0; border-radius: 6px;
      position: relative; overflow: hidden;
    }
    .range-map::after {
      content: "Global Range"; position: absolute; bottom: 2px; right: 4px; font-size: 0.55rem; color: #555;
    }
    /* Simple stylized world map via CSS gradients */
    .range-map-bg {
      width: 100%; height: 100%;
      background: 
        radial-gradient(circle at 30% 40%, #d1e8e2 20%, transparent 21%), /* N. America */
        radial-gradient(circle at 70% 30%, #d1e8e2 25%, transparent 26%), /* Eurasia */
        radial-gradient(circle at 40% 70%, #d1e8e2 18%, transparent 19%); /* S. America */
      opacity: 0.6;
    }
    .range-highlight {
      position: absolute; background: var(--accent-orange); opacity: 0.7; border-radius: 50%;
    }

    /* Status Badge */
    .status-badge {
      display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; margin-bottom: 10px;
    }
    .status-en { background: #ffebee; color: #c62828; border: 1px solid #ffcdd2; } /* Endangered */
    .status-vu { background: #fff3e0; color: #ef6c00; border: 1px solid #ffe0b2; } /* Vulnerable */
    .status-nt { background: #fff8e1; color: #f57f17; border: 1px solid #ffecb3; } /* Near Threatened */
    .status-lc { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; } /* Least Concern */
    .status-dd { background: #f5f5f5; color: #616161; border: 1px solid #e0e0e0; } /* Data Deficient / Other */

    /* Fact Reveal */
    .fact-box {
      margin-top: auto; background: rgba(77,123,72,0.1); padding: 10px; border-radius: 8px;
      font-size: 0.85rem; position: relative;
    }
    .fact-content { display: none; }
    .fact-content.visible { display: block; animation: fadeIn 0.4s; }
    .fact-btn {
      width: 100%; border: none; background: none; color: var(--accent-green); font-weight: 700; cursor: pointer; padding: 0; text-align: left;
    }
    @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

    #loading { text-align:center; font-style:italic; color:#888; margin: 40px; }

    footer{ text-align:center; margin-top:40px; padding:30px 10px; color:#666; font-size:0.95rem; }
    body.night footer{ color:#aaa; }

  </style>
</head>
<body>

<div id="stars" aria-hidden="true"></div>

<nav>
  <a href="index.html">Home</a>
  <a href="learn.html" style="color:var(--accent-orange)">Learn</a>
  <a href="about.html">About</a>
  <a href="shop.html">Shop</a>
  <a href="contact.html">Contact</a>

  <div class="dropdown">
    <span class="dropbtn">More â–¾</span>
    <div class="dropdown-content">
      <a href="calculator.html">Score Calculator</a>
      <a href="deckbuilder.html">Deck Builder</a>
      <a href="#">Rulebook (PDF)</a>
      <a href="#">Kickstarter</a>
    </div>
  </div>

  <div id="moon-toggle" aria-hidden="true">ðŸŒ™</div>
</nav>

<main class="container">
  <h1>The Living World</h1>
  <p style="text-align:center; max-width:600px; margin:0 auto 30px;">Filter species by habitat to learn about their roles in the ecosystem.</p>

  <!-- Filter Controls -->
  <div class="filter-bar" id="filters">
    <button class="filter-btn active" data-filter="all">All</button>
    <button class="filter-btn" data-filter="savannah">Savannah</button>
    <button class="filter-btn" data-filter="arctic">Arctic</button>
    <button class="filter-btn" data-filter="rainforest">Rainforest</button>
    <button class="filter-btn" data-filter="temperate">Temperate</button>
  </div>

  <div class="species-grid" id="grid">
    <div id="loading">Loading species data...</div>
    <!-- Cards will be injected here via JS -->
  </div>
</main>

<footer>
  <p>&copy; 2025 Goldwire Games. All rights reserved.</p>
  <p>Instagram: <a href="https://instagram.com/goldwiregames" target="_blank" rel="noopener noreferrer">@goldwiregames</a> | X: <a href="https://x.com/GoldwireGames" target="_blank" rel="noopener noreferrer">@GoldwireGames</a> </p>
  <p><a href="mailto:goldwiregames.studio@gmail.com">Contact Us</a></p>
</footer>

<script>
  // Night Mode
  const moon = document.getElementById('moon-toggle');
  const toggleNight = () => {
    document.body.classList.toggle('night');
    moon.textContent = document.body.classList.contains('night') ? 'ðŸŒ•' : 'ðŸŒ™';
  };
  moon.addEventListener('click', toggleNight);

  // --- CSV Loading Logic ---
  window.addEventListener('DOMContentLoaded', async () => {
      try {
          const response = await fetch('cards.csv');
          if (!response.ok) throw new Error("Could not find cards.csv");
          const text = await response.text();
          renderCardsFromCSV(text);
      } catch (err) {
          document.getElementById('loading').innerHTML = `Error: ${err.message}<br>Make sure 'cards.csv' is uploaded.`;
      }
  });

  function renderCardsFromCSV(csvText) {
      const rows = csvText.trim().split('\n');
      const grid = document.getElementById('grid');
      grid.innerHTML = ''; // Clear loading

      // CSV Parser (simple)
      const parseLine = (line) => {
          const result = [];
          let current = '';
          let inQuotes = false;
          for (let char of line) {
              if (char === '"') { inQuotes = !inQuotes; }
              else if (char === ',' && !inQuotes) { result.push(current.trim()); current = ''; }
              else { current += char; }
          }
          result.push(current.trim());
          return result;
      };

      // Skip header (row 0)
      for (let i = 1; i < rows.length; i++) {
          const cols = parseLine(rows[i]);
          if (cols.length < 10) continue;

          // Mapping based on your CSV structure:
          // 0: Animal (Name)
          // 2: Color (used for background hint)
          // 3: Habitat (Maasai, Arctic, Rockies, Jungle, Tagia)
          // 5: Level (used for role/tier)
          // 6: Trait (used for pill badge or role)
          // 7: Ability (Could be the "Fact" if no explicit fact column exists yet)
          // 10: Game (Filter for Base if desired, or show all)

          const name = cols[0];
          const habitatRaw = cols[3] || "Unknown";
          const level = cols[5] || "0";
          const trait = cols[6] || "Species";
          const abilityText = cols[7] || "No description available.";
          
          // Map CSV Habitat to CSS Class/Filter ID
          let habitatClass = "unknown";
          let habitatColor = "#ccc";
          
          const h = habitatRaw.toLowerCase();
          if (h.includes("maasai")) { habitatClass = "savannah"; habitatColor = "#E8D5B5"; }
          else if (h.includes("arctic")) { habitatClass = "arctic"; habitatColor = "#AFEEEE"; }
          else if (h.includes("rockies") || h.includes("tagia")) { habitatClass = "temperate"; habitatColor = "#A9A9A9"; }
          else if (h.includes("jungle") || h.includes("amazon")) { habitatClass = "rainforest"; habitatColor = "#90EE90"; }

          // Create Card HTML
          const card = document.createElement('div');
          card.className = "species-card";
          card.setAttribute('data-habitat', habitatClass);
          
          card.innerHTML = `
            <div class="species-img" style="background-color: ${habitatColor};">
              <span class="species-type">Level ${level}</span>
            </div>
            <div class="card-body">
              <div class="scientific-name">${trait}</div>
              <h3 class="common-name">${name}</h3>
              <span class="status-badge status-lc">Base Set</span>
              
              <div class="range-map">
                <div class="range-map-bg"></div>
                <div class="range-highlight" style="top: 50%; left: 50%; width: 10px; height: 10px;"></div>
              </div>

              <div class="fact-box">
                <button class="fact-btn">Ability â–¼</button>
                <div class="fact-content">
                  ${abilityText.replace(/"/g, '')}
                </div>
              </div>
            </div>
          `;
          
          grid.appendChild(card);
      }

      setupFilters();
      setupAccordions();
  }

  function setupFilters() {
      const buttons = document.querySelectorAll('.filter-btn');
      const cards = document.querySelectorAll('.species-card');

      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          buttons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          const filter = btn.getAttribute('data-filter');

          cards.forEach(card => {
            if (filter === 'all' || card.getAttribute('data-habitat') === filter) {
              card.style.display = 'flex';
              card.style.animation = 'none';
              card.offsetHeight; /* trigger reflow */
              card.style.animation = 'fadeIn 0.5s ease';
            } else {
              card.style.display = 'none';
            }
          });
        });
      });
  }

  function setupAccordions() {
      document.querySelectorAll('.fact-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const content = btn.nextElementSibling;
          content.classList.toggle('visible');
          btn.textContent = content.classList.contains('visible') ? 'Hide Ability â–²' : 'Ability â–¼';
        });
      });
  }
</script>

</body>
</html>
